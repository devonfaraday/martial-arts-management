<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Student Details</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/htmx.org@1.9.6"
        integrity="sha384-FhXw7b6AlE/jyjlZH5iHa/tTe9EpJ1Y55RjcgPbjeWMskSxZt1v9qkxLJWNJaGni"
        crossorigin="anonymous"></script>
    <meta name="csrf-token" th:content="${_csrf.token}" />
    <meta name="csrf-header" th:content="${_csrf.headerName}" />
    <script src="/js/csrf-config.js"></script>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col">
    <!-- Header -->
    <header th:replace="~{layout/header :: header}"></header>

    <!-- Main Content -->
    <main class="container mx-auto p-8 flex gap-8">
        <!-- Main Form Container -->
        <div class="flex-grow bg-white shadow-lg rounded-lg p-6">
            <h1 class="text-2xl font-bold text-gray-800 mb-6">Student Details</h1>
            
            <form th:action="@{/students/edit/{id}(id=${student.id})}" 
                  th:object="${student}" 
                  method="post" 
                  id="studentForm"
                  class="space-y-8">
                
                <!-- Personal Information Section -->
                <section>
                    <h2 class="text-lg font-semibold text-blue-600 mb-4">Personal Information</h2>
                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <label for="firstName" class="block text-sm font-medium text-gray-700">First Name</label>
                            <input type="text" id="firstName" th:field="*{firstName}" required
                                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" />
                        </div>
                        <div>
                            <label for="lastName" class="block text-sm font-medium text-gray-700">Last Name</label>
                            <input type="text" id="lastName" th:field="*{lastName}" required
                                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" />
                        </div>
                        <div>
                            <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
                            <input type="email" id="email" th:field="*{email}" required
                                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" />
                        </div>
                        <div>
                            <label for="phoneNumber" class="block text-sm font-medium text-gray-700">Phone</label>
                            <input type="text" id="phoneNumber" th:field="*{phoneNumber}" required
                                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" />
                        </div>
                    </div>
                </section>

                <!-- Address Section -->
                <section>
                    <h2 class="text-lg font-semibold text-blue-600 mb-4">Home Address</h2>
                    <div class="grid grid-cols-2 gap-6">
                        <div class="col-span-2">
                            <label for="homeAddress.street" class="block text-sm font-medium text-gray-700">Street</label>
                            <input type="text" id="homeAddress.street" th:field="*{homeAddress.street}"
                                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" />
                        </div>
                        <div>
                            <label for="homeAddress.city" class="block text-sm font-medium text-gray-700">City</label>
                            <input type="text" id="homeAddress.city" th:field="*{homeAddress.city}"
                                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" />
                        </div>
                        <div>
                            <label for="homeAddress.state" class="block text-sm font-medium text-gray-700">State</label>
                            <input type="text" id="homeAddress.state" th:field="*{homeAddress.state}"
                                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" />
                        </div>
                        <div>
                            <label for="homeAddress.zipCode" class="block text-sm font-medium text-gray-700">ZIP Code</label>
                            <input type="text" id="homeAddress.zipCode" th:field="*{homeAddress.zipCode}"
                                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" />
                        </div>
                        <div>
                            <label for="homeAddress.country" class="block text-sm font-medium text-gray-700">Country</label>
                            <input type="text" id="homeAddress.country" th:field="*{homeAddress.country}"
                                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" />
                        </div>
                    </div>
                </section>

                <!-- Billing Information Section -->
                <section>
                    <h2 class="text-lg font-semibold text-blue-600 mb-4">Billing Information</h2>
                    <div class="grid grid-cols-2 gap-6">
                        <div>
                            <label for="billingInfo.cardNumber" class="block text-sm font-medium text-gray-700">Card Number</label>
                            <input type="text" id="billingInfo.cardNumber" th:field="*{billingInfo.cardNumber}"
                                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" />
                        </div>
                        <div>
                            <label for="billingInfo.cardHolderName" class="block text-sm font-medium text-gray-700">Cardholder Name</label>
                            <input type="text" id="billingInfo.cardHolderName" th:field="*{billingInfo.cardHolderName}"
                                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" />
                        </div>
                        <div>
                            <label for="billingInfo.expirationDate" class="block text-sm font-medium text-gray-700">Expiration Date</label>
                            <input type="text" id="billingInfo.expirationDate" th:field="*{billingInfo.expirationDate}" placeholder="MM/YY"
                                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" />
                        </div>
                        <div>
                            <label for="billingInfo.securityCode" class="block text-sm font-medium text-gray-700">Security Code (CVV)</label>
                            <input type="text" id="billingInfo.securityCode" th:field="*{billingInfo.securityCode}"
                                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" />
                        </div>
                        <div>
                            <label for="billingInfo.billingStreet" class="block text-sm font-medium text-gray-700">Billing Street</label>
                            <input type="text" id="billingInfo.billingStreet" th:field="*{billingInfo.billingStreet}"
                                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" />
                        </div>
                        <div>
                            <label for="billingInfo.billingCity" class="block text-sm font-medium text-gray-700">Billing City</label>
                            <input type="text" id="billingInfo.billingCity" th:field="*{billingInfo.billingCity}"
                                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" />
                        </div>
                        <div>
                            <label for="billingInfo.billingState" class="block text-sm font-medium text-gray-700">Billing State</label>
                            <input type="text" id="billingInfo.billingState" th:field="*{billingInfo.billingState}"
                                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" />
                        </div>
                        <div>
                            <label for="billingInfo.billingZipCode" class="block text-sm font-medium text-gray-700">Billing ZIP Code</label>
                            <input type="text" id="billingInfo.billingZipCode" th:field="*{billingInfo.billingZipCode}"
                                   class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" />
                        </div>
                    </div>
                </section>

                <!-- Emergency Contacts Section -->
                <section>
                    <h2 class="text-lg font-semibold text-blue-600 mb-4">Emergency Contacts</h2>
                    <div th:each="contact, iterStat : ${student.emergencyContacts}" class="mb-6">
                        <h3 class="text-md font-medium text-gray-700 mb-4">Contact [[${iterStat.index + 1}]]:</h3>
                        <div class="grid grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Name</label>
                                <input type="text" th:field="*{emergencyContacts[__${iterStat.index}__].name}"
                                       class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" required />
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Relationship</label>
                                <input type="text" th:field="*{emergencyContacts[__${iterStat.index}__].relationship}"
                                       class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" required />
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Phone Number</label>
                                <input type="text" th:field="*{emergencyContacts[__${iterStat.index}__].phoneNumber}"
                                       class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" required />
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700">Email</label>
                                <input type="email" th:field="*{emergencyContacts[__${iterStat.index}__].email}"
                                       class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" required />
                            </div>
                        </div>
                    </div>
                </section>
            </form>

            <!-- Action Buttons -->
            <div class="border-t pt-6 mt-8">
                <div class="flex justify-between items-center">
                    <div class="flex items-center space-x-4">
                        <a th:href="@{/students}" 
                           class="bg-gray-600 text-white px-6 py-2 rounded-lg shadow hover:bg-gray-700 transition duration-300 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
                            </svg>
                            Back to List
                        </a>
                    </div>
                    <div class="flex items-center space-x-4">
                        <button type="submit" form="studentForm"
                                class="bg-blue-600 text-white px-6 py-2 rounded-lg shadow hover:bg-blue-700 transition duration-300 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
                            </svg>
                            Save Changes
                        </button>
                        <a th:href="@{/students/delete/{id}(id=${student.id})}"
                        class="bg-red-600 text-white px-6 py-2 rounded-lg shadow hover:bg-red-700 transition duration-300 flex items-center"
                        onclick="return confirm('Are you sure you want to delete this student?');">
                         <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                             <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
                         </svg>
                         Delete
                     </a>
                 </div>
             </div>
         </div>
     </div>
 </div>

    <!-- Status Box -->

                <!-- Status Box with original HTMX functionality -->
    <div class="w-80 bg-white shadow-lg rounded-lg p-6 h-fit">
        <h2 class="text-lg font-semibold text-gray-800 mb-4">Update Status</h2>
        <div class="space-y-4">
            <label for="status" class="block text-sm font-medium text-gray-700">Student Status</label>
            <select id="status" 
                    name="status" 
                    th:hx-put="@{/students/{id}/status(id=${student.id})}"
                    hx-trigger="change" 
                    hx-swap="none"
                    class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:ring-blue-500 focus:border-blue-500">
                <option th:each="status : ${statuses}" 
                        th:value="${status.name()}" 
                        th:text="${status.displayName}"
                        th:selected="${student.status == status}">
                </option>
            </select>
        </div>
    </div>
</main>
    </body>

</html>